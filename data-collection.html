<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datos de Registro de Inscripción de IGT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Importar Firebase SDK -->
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Tu configuración de Firebase (DEBE SER LA MISMA QUE EN auth.html)
        const firebaseConfig = {
            apiKey: "AIzaSyCQPZiekhX6LOitpyAy1pYUNb0Lb74k8WQ",
            authDomain: "instituto-gerencial-de-talento.firebaseapp.com",
            projectId: "instituto-gerencial-de-talento",
            storageBucket: "instituto-gerencial-de-talento.firebasestorage.app",
            messagingSenderId: "549000895234",
            appId: "1:549000895234:web:e3621a884d7078d350c01b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Ocultar mensajes de log de Firebase
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        setLogLevel('error');

        let currentPhase = 1;
        const totalPhases = 3;

        // Elementos de navegación y fases
        const mainFormCard = document.getElementById('main-form-card');
        const phaseIndicator = document.getElementById('phase-indicator');
        const phase1Div = document.getElementById('phase-1');
        const phase2Div = document.getElementById('phase-2');
        const phase3Div = document.getElementById('phase-3');
        const prevButton = document.getElementById('prev-phase-btn');
        const nextButton = document.getElementById('next-phase-btn');
        const finishButton = document.getElementById('finish-registration-btn');
        const logoutButton = document.getElementById('logout-btn');

        // Campos de la Fase 1
        const firstNameDisplay = document.getElementById('first-name-display');
        const lastNameDisplay = document === 'false'.getElementById('last-name-display');
        const emailDisplay = document.getElementById('email-display');
        const phonePrefixInput = document.getElementById('phone-prefix-select');
        const phoneNumberInput = document.getElementById('phone-number');
        const ciTypeInput = document.getElementById('ci-type-select');
        const ciNumberInput = document.getElementById('ci-number');
        const addressInput = document.getElementById('address');
        const dobInput = document.getElementById('dob');
        const ageDisplay = document.getElementById('age-display');
        const courseToApplyInput = document.getElementById('course-to-apply-select');
        const genderInput = document.getElementById('gender-select');

        // Campos de la Fase 2
        const educationStatusInput = document.getElementById('education-status-select');
        const studyShiftInput = document.getElementById('study-shift-select');
        const currentStudyLevelInput = document.getElementById('current-study-level-select');
        const institutionInput = document.getElementById('institution');
        const degreeInput = document.getElementById('degree');
        const graduationYearInput = document.getElementById('graduation-year');

        // Campos de la Fase 3 (inputs de tipo file son placeholders por ahora)
        const ciUploadInput = document.getElementById('ci-upload');
        const degreeUploadInput = document.getElementById('degree-upload');
        const otherDocsUploadInput = document.getElementById('other-docs-upload');
        const agreeTermsCheckbox = document.getElementById('agree-terms');


        // Funciones auxiliares
        function calculateAge(dateOfBirth) {
            if (!dateOfBirth) return '';
            const today = new Date();
            const birthDate = new Date(dateOfBirth);
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age >= 0 ? age : '';
        }

        dobInput.addEventListener('change', () => {
            ageDisplay.textContent = calculateAge(dobInput.value);
            // No triggerAutoSave, se guarda al pasar de fase.
        });

        // Lógica condicional para Turno de estudio
        educationStatusInput.addEventListener('change', () => {
            const status = educationStatusInput.value;
            const studyShiftContainer = document.getElementById('study-shift-container');
            if (status === 'Estudiando Liceo' || status === 'Estudiando Universidad') {
                studyShiftContainer.classList.remove('hidden');
                studyShiftInput.setAttribute('required', 'required');
            } else {
                studyShiftContainer.classList.add('hidden');
                studyShiftInput.removeAttribute('required');
                studyShiftInput.value = ''; // Limpiar si se oculta
                // También limpiar el display del modal
                document.getElementById('study-shift-display').textContent = 'Selecciona el turno';
            }
        });


        // Nueva función para guardar datos al cambiar de fase o finalizar
        async function saveFormDataOnPhaseChange() {
            const currentUser = auth.currentUser;
            if (!currentUser) return;

            console.log("Guardando datos al cambiar de fase...");
            const userProfileRef = doc(db, `artifacts/default-app-id/users/${currentUser.uid}/private_data/user_profile`);
            
            // Recolectar todos los datos del formulario que pueden ser guardados
            const dataToSave = {
                currentPhase: currentPhase,
                phone: `${phonePrefixInput.value}${phoneNumberInput.value}`,
                ciType: ciTypeInput.value,
                ciNumber: ciNumberInput.value,
                address: addressInput.value,
                dateOfBirth: dobInput.value,
                courseToApply: courseToApplyInput.value,
                gender: genderInput.value,
                
                educationStatus: educationStatusInput.value,
                studyShift: studyShiftInput.value,
                currentStudyLevel: currentStudyLevelInput.value,
                institution: institutionInput.value,
                degree: degreeInput.value,
                graduationYear: graduationYearInput.value ? parseInt(graduationYearInput.value) : null, 

                updatedAt: new Date()
            };

            try {
                await setDoc(userProfileRef, dataToSave, { merge: true });
                console.log("Datos guardados en Firestore.");
            } catch (error) {
                console.error("Error al guardar datos:", error);
            }
        }


        // Lógica de fases
        function updatePhaseIndicator() {
            const phaseElements = document.querySelectorAll('.phase-step');
            phaseElements.forEach((el, index) => {
                if (index < currentPhase - 1) {
                    el.classList.add('bg-blue-600', 'text-white');
                    el.classList.remove('bg-gray-700', 'text-gray-400');
                } else if (index === currentPhase - 1) {
                    el.classList.add('bg-blue-600', 'text-white');
                    el.classList.remove('bg-gray-700', 'text-gray-400');
                }
                else {
                    el.classList.add('bg-gray-700', 'text-gray-400');
                    el.classList.remove('bg-blue-600', 'text-white');
                }
            });
        }

        function showPhase(phaseNumber) {
            phase1Div.classList.add('hidden');
            phase2Div.classList.add('hidden');
            phase3Div.classList.add('hidden');

            switch (phaseNumber) {
                case 1:
                    phase1Div.classList.remove('hidden');
                    prevButton.classList.add('hidden');
                    nextButton.classList.remove('hidden');
                    finishButton.classList.add('hidden');
                    break;
                case 2:
                    phase2Div.classList.remove('hidden');
                    prevButton.classList.remove('hidden');
                    nextButton.classList.remove('hidden');
                    finishButton.classList.add('hidden');
                    break;
                case 3:
                    phase3Div.classList.remove('hidden');
                    prevButton.classList.remove('hidden');
                    nextButton.classList.add('hidden');
                    finishButton.classList.remove('hidden');
                    break;
            }
            currentPhase = phaseNumber;
            updatePhaseIndicator();
            if (mainFormCard) {
                mainFormCard.scrollTop = 0;
            }
        }

        function validateCurrentPhase() {
            let isValid = true;
            let fieldsToValidate = [];

            // Limpiar resaltado de errores anteriores
            document.querySelectorAll('#user-data-form .border-red-500').forEach(el => {
                el.classList.remove('border-red-500', 'ring-red-500');
            });

            switch (currentPhase) {
                case 1:
                    fieldsToValidate = [
                        phonePrefixInput, phoneNumberInput, ciTypeInput, ciNumberInput, addressInput, dobInput, courseToApplyInput, genderInput
                    ];

                    // Validación de edad
                    const age = calculateAge(dobInput.value);
                    if (age === '' || age < 16 || age > 18) {
                        alert("El instituto solo permite la postulación de personas entre 16 y 18 años de edad.");
                        dobInput.classList.add('border-red-500', 'ring-red-500');
                        isValid = false;
                    }
                    break;
                case 2:
                    fieldsToValidate = [
                        educationStatusInput, currentStudyLevelInput, institutionInput, graduationYearInput
                    ];
                    const status = educationStatusInput.value;
                    if (status === 'Estudiando Liceo' || status === 'Estudiando Universidad') {
                        fieldsToValidate.push(studyShiftInput);
                    }
                    // degreeInput es opcional
                    break;
                case 3:
                    fieldsToValidate = [
                        agreeTermsCheckbox
                    ];
                    if (!agreeTermsCheckbox.checked) {
                        isValid = false;
                    }
                    break;
            }

            for (const field of fieldsToValidate) {
                // Para los selectores personalizados, validar el valor del select oculto y el display div
                const displayElement = document.getElementById(field.id.replace('-select', '-display'));
                
                if (field.type === 'file') {
                    continue; 
                }
                if (field.value.trim() === '' || (field.type === 'checkbox' && !field.checked)) {
                    field.classList.add('border-red-500', 'ring-red-500');
                    if (displayElement) displayElement.classList.add('border-red-500', 'ring-red-500'); // Resaltar el div de display
                    isValid = false;
                } else {
                    field.classList.remove('border-red-500', 'ring-red-500');
                    if (displayElement) displayElement.classList.remove('border-red-500', 'ring-red-500');
                }
            }

            if (!isValid) {
                alert("Por favor, completa todos los campos requeridos en esta fase.");
            }
            return isValid;
        }

        async function nextPhase() {
            if (validateCurrentPhase()) {
                await saveFormDataOnPhaseChange();
                if (currentPhase < totalPhases) {
                    showPhase(currentPhase + 1);
                }
            }
        }

        async function prevPhase() {
            await saveFormDataOnPhaseChange();
            
            if (currentPhase > 1) {
                showPhase(currentPhase - 1);
            }
        }

        prevButton.addEventListener('click', prevPhase);
        nextButton.addEventListener('click', nextPhase);
        
        // Listener para el estado de autenticación (ejecutado al cargar la página)
        onAuthStateChanged(auth, async (user) => {
            console.log("data-collection.html: onAuthStateChanged fired. User:", user ? user.email : "null", "Verified:", user ? user.emailVerified : "N/A");

            if (user && user.emailVerified) {
                const userProfileRef = doc(db, `artifacts/default-app-id/users/${user.uid}/private_data/user_profile`);
                const userProfileSnap = await getDoc(userProfileRef);
                const userProfileData = userProfileSnap.exists() ? userProfileSnap.data() : {};

                if (userProfileData.dataCollected === true) {
                    console.log("data-collection.html: Datos ya recolectados. Redirigiendo a dashboard.html.");
                    window.location.href = 'dashboard.html';
                    return;
                }

                currentPhase = userProfileData.currentPhase || 1;

                firstNameDisplay.textContent = userProfileData.firstName || 'N/A';
                lastNameDisplay.textContent = userProfileData.lastName || 'N/A';
                emailDisplay.textContent = user.email || 'N/A';
                
                // Cargar datos en los campos editables y actualizar los displays de modal
                // Teléfono
                const fullPhone = userProfileData.phone || '';
                if (fullPhone.length >= 4) {
                    phonePrefixInput.value = fullPhone.substring(0, 4);
                    document.getElementById('phone-prefix-display').textContent = phonePrefixInput.value;
                    phoneNumberInput.value = fullPhone.substring(4);
                } else {
                    phonePrefixInput.value = ''; 
                    document.getElementById('phone-prefix-display').textContent = '04XX';
                    phoneNumberInput.value = fullPhone;
                }
                
                // Cédula de Identidad
                const ciNumber = userProfileData.ciNumber || '';
                const ciType = userProfileData.ciType || '';
                if (ciType && ciNumber) {
                    ciTypeInput.value = ciType;
                    document.getElementById('ci-type-display').textContent = ciType;
                    ciNumberInput.value = ciNumber;
                } else if (userProfileData.ci) {
                    const oldCi = userProfileData.ci;
                     if (oldCi.startsWith('V') || oldCi.startsWith('E')) {
                        ciTypeInput.value = oldCi.substring(0,1);
                        document.getElementById('ci-type-display').textContent = ciTypeInput.value;
                        ciNumberInput.value = oldCi.substring(1);
                    } else if (oldCi.length > 0) {
                        ciTypeInput.value = 'V';
                        document.getElementById('ci-type-display').textContent = 'V';
                        ciNumberInput.value = oldCi;
                    }
                }


                addressInput.value = userProfileData.address || '';
                dobInput.value = userProfileData.dateOfBirth || '';
                
                courseToApplyInput.value = userProfileData.courseToApply || '';
                document.getElementById('course-to-apply-display').textContent = courseToApplyInput.value || 'Selecciona un curso';

                genderInput.value = userProfileData.gender || '';
                document.getElementById('gender-display').textContent = genderInput.value || 'Selecciona tu género';

                // Campos de Fase 2
                educationStatusInput.value = userProfileData.educationStatus || '';
                document.getElementById('education-status-display').textContent = educationStatusInput.value || 'Selecciona tu estado';

                studyShiftInput.value = userProfileData.studyShift || '';
                document.getElementById('study-shift-display').textContent = studyShiftInput.value || 'Selecciona el turno';

                currentStudyLevelInput.value = userProfileData.currentStudyLevel || '';
                document.getElementById('current-study-level-display').textContent = currentStudyLevelInput.value || 'Selecciona el nivel';
                
                institutionInput.value = userProfileData.institution || '';
                degreeInput.value = userProfileData.degree || '';
                graduationYearInput.value = userProfileData.graduationYear || '';

                ageDisplay.textContent = calculateAge(dobInput.value);

                // Ejecutar la lógica condicional de turno de estudio al cargar los datos
                const status = educationStatusInput.value;
                const studyShiftContainer = document.getElementById('study-shift-container');
                if (status === 'Estudiando Liceo' || status === 'Estudiando Universidad') {
                    studyShiftContainer.classList.remove('hidden');
                    studyShiftInput.setAttribute('required', 'required');
                    document.getElementById('study-shift-display').setAttribute('required', 'required');
                } else {
                    studyShiftContainer.classList.add('hidden');
                    studyShiftInput.removeAttribute('required');
                    document.getElementById('study-shift-display').removeAttribute('required');
                }

                showPhase(currentPhase);
                document.body.classList.remove('hidden');
            } else {
                console.log("data-collection.html: Usuario no autenticado o no verificado. Redirigiendo a auth.html.");
                await signOut(auth);
                window.location.href = 'auth.html';
            }
        });

        async function handleSubmitData(event) {
            event.preventDefault();
            await saveFormDataOnPhaseChange();

            if (!validateCurrentPhase()) {
                return;
            }

            const currentUser = auth.currentUser;
            if (!currentUser) {
                alert("No hay usuario autenticado. Redirigiendo al login.");
                window.location.href = 'auth.html';
                return;
            }
            
            const dataToSaveFinal = {
                currentPhase: totalPhases,
                phone: `${phonePrefixInput.value}${phoneNumberInput.value}`,
                ciType: ciTypeInput.value,
                ciNumber: ciNumberInput.value,
                address: addressInput.value,
                dateOfBirth: dobInput.value,
                courseToApply: courseToApplyInput.value,
                gender: genderInput.value,
                
                educationStatus: educationStatusInput.value,
                studyShift: studyShiftInput.value,
                currentStudyLevel: currentStudyLevelInput.value,
                institution: institutionInput.value,
                degree: degreeInput.value,
                graduationYear: graduationYearInput.value ? parseInt(graduationYearInput.value) : null,
                
                dataCollected: true,
                updatedAt: new Date()
            };

            try {
                const userProfileRef = doc(db, `artifacts/default-app-id/users/${currentUser.uid}/private_data/user_profile`);
                await setDoc(userProfileRef, dataToSaveFinal, { merge: true });

                alert("¡Registro completado exitosamente! Redirigiendo al dashboard.");
                console.log("Registro completado, redirigiendo a dashboard.html.");
                window.location.href = 'dashboard.html';
            } catch (error) {
                console.error("Error al finalizar el registro:", error.message);
                alert("Error al finalizar el registro. Por favor, inténtalo de nuevo.");
            }
        }
        finishButton.addEventListener('click', handleSubmitData);

        async function handleLogout() {
            try {
                await signOut(auth);
                window.location.href = 'auth.html';
            } catch (error) {
                console.error("Error al cerrar sesión:", error.message);
                alert("Error al cerrar sesión. Por favor, inténtalo de nuevo.");
            }
        }
        window.handleLogout = handleLogout;


        // --- Lógica de Modales Personalizados ---

        // Abrir modal genérico
        function openCustomSelectModal(selectId, displayElementId, titleText) {
            currentModalTargetSelectId = selectId;
            currentModalTargetDisplayId = displayElementId;
            modalTitle.textContent = titleText;
            modalOptionsContainer.innerHTML = ''; // Limpiar opciones anteriores

            const selectElement = document.getElementById(selectId);
            if (!selectElement) return;

            // Añadir una opción "vacía" si el select lo permite (no es required)
            // y no tiene un valor ya seleccionado.
            if (!selectElement.hasAttribute('required') && !selectElement.value) {
                 const emptyOptionDiv = document.createElement('div');
                 emptyOptionDiv.className = 'modal-option text-gray-500';
                 emptyOptionDiv.textContent = 'Selecciona una opción...'; // O un texto más genérico si quieres
                 emptyOptionDiv.dataset.value = '';
                 emptyOptionDiv.addEventListener('click', () => selectCustomOption(selectId, displayElementId, '', 'Selecciona una opción...'));
                 modalOptionsContainer.appendChild(emptyOptionDiv);
            }

            Array.from(selectElement.options).forEach(option => {
                // Saltar la opción "Selecciona una opción..." si el select es requerido o ya se agregó una opción vacía genérica
                if (option.value === "" && selectElement.hasAttribute('required')) {
                    return;
                }
                const optionDiv = document.createElement('div');
                optionDiv.className = 'modal-option';
                optionDiv.textContent = option.textContent;
                optionDiv.dataset.value = option.value;
                if (option.value === selectElement.value) {
                    optionDiv.classList.add('modal-option-selected'); // Resaltar opción seleccionada
                }
                optionDiv.addEventListener('click', () => selectCustomOption(selectId, displayElementId, option.value, option.textContent));
                modalOptionsContainer.appendChild(optionDiv);
            });

            customSelectModal.classList.remove('hidden');
            setTimeout(() => { // Pequeño retraso para la transición de opacidad
                customSelectModal.classList.add('opacity-100');
            }, 10);
        }

        // Seleccionar opción y cerrar modal
        function selectCustomOption(selectId, displayElementId, value, text) {
            const selectElement = document.getElementById(selectId);
            const displayElement = document.getElementById(displayElementId);

            if (selectElement) {
                selectElement.value = value;
                selectElement.dispatchEvent(new Event('change')); // Disparar evento change para la lógica condicional (ej. study-shift)
            }
            if (displayElement) {
                displayElement.textContent = text;
                // Remover la clase de error si existía del display element
                displayElement.classList.remove('border-red-500', 'ring-red-500');
            }
            closeCustomSelectModal();
        }

        // Cerrar modal
        function closeCustomSelectModal() {
            customSelectModal.classList.remove('opacity-100');
            customSelectModal.classList.add('opacity-0');
            setTimeout(() => {
                customSelectModal.classList.add('hidden');
            }, 300); // Coincide con la duración de la transición CSS
        }

        // Asignar listeners a los divs que abrirán los modales
        document.getElementById('phone-prefix-display').addEventListener('click', () => openCustomSelectModal('phone-prefix-select', 'phone-prefix-display', 'Selecciona un prefijo'));
        document.getElementById('ci-type-display').addEventListener('click', () => openCustomSelectModal('ci-type-select', 'ci-type-display', 'Selecciona el tipo de C.I.'));
        document.getElementById('course-to-apply-display').addEventListener('click', () => openCustomSelectModal('course-to-apply-select', 'course-to-apply-display', 'Selecciona el curso'));
        document.getElementById('gender-display').addEventListener('click', () => openCustomSelectModal('gender-select', 'gender-display', 'Selecciona tu género'));
        document.getElementById('education-status-display').addEventListener('click', () => openCustomSelectModal('education-status-select', 'education-status-display', 'Selecciona tu estado educativo'));
        document.getElementById('study-shift-display').addEventListener('click', () => openCustomSelectModal('study-shift-select', 'study-shift-display', 'Selecciona el turno de estudio'));
        document.getElementById('current-study-level-display').addEventListener('click', () => openCustomSelectModal('current-study-level-select', 'current-study-level-display', 'Selecciona tu nivel de estudio'));

        // Cerrar modal al hacer clic fuera
        customSelectModal.addEventListener('click', (event) => {
            if (event.target === customSelectModal) { // Solo si el clic es en el overlay
                closeCustomSelectModal();
            }
        });
        // --- Fin Lógica de Modales Personalizados ---
    </script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0e172a;
            color: #e2e8f0;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .container-card {
            background-color: #1c1c24;
            border-radius: 0;
            padding: 2.5rem;
            box-shadow: none;
            width: 100%;
            height: 100vh;
            margin: 0;
            max-width: none;
            color: #e2e8f0;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            position: relative;
        }
        @media (max-width: 768px) {
            .container-card {
                padding: 1.5rem;
                height: 100vh;
            }
        }
        .section-title {
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #4a5568;
            color: #f8fafc;
        }
        .form-label {
            display: block;
            color: #cbd5e0;
            font-size: 0.875rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        .display-field {
            background-color: #2d3748;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 1rem;
            color: #f8fafc;
            border: 1px solid #4a5568;
        }
        /* Clase común para los divs que actúan como selectores */
        .custom-select-display {
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background-color: #0e172a;
            color: #e2e8f0;
            border: 1px solid #4a5568;
            padding: 0.75rem; /* Ajustar padding para que coincida con otros inputs */
            border-radius: 0.5rem; /* rounded-lg */
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .custom-select-display:focus, .custom-select-display:hover {
            transform: scale(1.01);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
            border-color: #3b82f6;
        }

        .animated-input {
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background-color: #0e172a;
            color: #e2e8f0;
            border: 1px solid #4a5568;
        }
        .animated-input:focus {
            transform: scale(1.01);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
            border-color: #3b82f6;
        }
        .animated-btn {
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow 0.3s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .animated-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2);
        }
        /* Estilos para el indicador de fase */
        .phase-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }
        .phase-step {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 9999px; /* full rounded */
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.25rem; /* text-xl */
            transition: all 0.3s ease-in-out;
        }
        .phase-divider {
            height: 2px;
            width: 2rem;
            background-color: #4a5568; /* gray-600 */
            align-self: center;
            margin: 0 0.5rem;
        }
        /* Oculta el body por defecto hasta que se verifique la autenticación */
        body.hidden {
            display: none;
        }

        /* --- Estilos de Scrollbar Personalizada --- */
        .container-card::-webkit-scrollbar {
            width: 8px; /* Ancho de la barra de desplazamiento */
        }

        .container-card::-webkit-scrollbar-track {
            background: #1c1c24; /* Fondo de la pista de la barra de desplazamiento */
            border-radius: 10px;
        }

        .container-card::-webkit-scrollbar-thumb {
            background-color: #3b82f6; /* Color del "pulgar" (la parte que se arrastra) */
            border-radius: 10px;
            border: 2px solid #1c1c24; /* Un borde para que se vea más flotante */
        }

        .container-card::-webkit-scrollbar-thumb:hover {
            background-color: #2563eb; /* Color al pasar el ratón */
        }
        /* Fin de Estilos de Scrollbar Personalizada */

        /* --- Estilos del Modal Personalizado --- */
        .custom-select-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Fondo oscuro semitransparente */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .custom-select-modal-content {
            background-color: #1c1c24; /* Color de la tarjeta */
            border-radius: 1rem;
            padding: 1.5rem;
            width: 90%;
            max-width: 400px;
            max-height: 80vh; /* Para permitir scroll si hay muchas opciones */
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            transform: scale(0.95); /* Pequeña animación de entrada */
            transition: transform 0.3s ease-in-out;
        }
        .custom-select-modal-overlay.opacity-100 .custom-select-modal-content {
            transform: scale(1);
        }

        .modal-option {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out;
            color: #e2e8f0;
            margin-bottom: 0.25rem;
        }
        .modal-option:last-child {
            margin-bottom: 0;
        }
        .modal-option:hover {
            background-color: #2d3748; /* Fondo más claro al pasar el ratón */
        }
        .modal-option-selected {
            background-color: #3b82f6; /* blue-600 */
            color: white;
            font-weight: 500;
        }
        /* Fin de Estilos del Modal Personalizado */
    </style>
</head>
<body class="bg-[#0e172a] min-h-screen flex items-center justify-center hidden">
    <div id="main-form-card" class="container-card">
        <h1 class="text-3xl font-bold text-center mb-8 text-blue-400">Datos de Registro de Inscripción de IGT</h1>
        <p class="text-center text-gray-400 mb-6">Completa los siguientes pasos para finalizar tu inscripción.</p>

        <!-- Indicador de Fases -->
        <div id="phase-indicator" class="phase-indicator">
            <div class="phase-step bg-gray-700 text-gray-400" data-phase="1">1</div>
            <div class="phase-divider"></div>
            <div class="phase-step bg-gray-700 text-gray-400" data-phase="2">2</div>
            <div class="phase-divider"></div>
            <div class="phase-step bg-gray-700 text-gray-400" data-phase="3">3</div>
        </div>

        <form id="user-data-form" class="space-y-6 flex-grow">
            <!-- Fase 1: Datos Generales -->
            <div id="phase-1" class="phase-content space-y-4">
                <div class="border border-gray-700 rounded-lg p-4 bg-[#1c1c24]">
                    <h2 class="section-title mb-4">Información General</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Nombre:</label>
                            <p id="first-name-display" class="display-field"></p>
                        </div>
                        <div>
                            <label class="form-label">Apellido:</label>
                            <p id="last-name-display" class="display-field"></p>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Correo Electrónico:</label>
                        <p id="email-display" class="display-field"></p>
                    </div>
                </div>

                <div class="border border-gray-700 rounded-lg p-4 bg-[#1c1c24]">
                    <h2 class="section-title mb-4">Datos del Contacto e Identificación</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Número Telefónico:</label>
                            <div class="flex gap-2">
                                <div id="phone-prefix-display" class="custom-select-display w-1/3" required>
                                    04XX <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </div>
                                <input type="tel" id="phone-number" placeholder="Ej: 1234567" class="w-2/3 rounded-lg p-3 focus:outline-none focus:ring-2 animated-input" pattern="[0-9]{7}" title="7 dígitos numéricos" required>
                            </div>
                            <select id="phone-prefix-select" class="hidden"> <!-- SELECT OCULTO -->
                                <option value="0412">0412</option>
                                <option value="0414">0414</option>
                                <option value="0416">0416</option>
                                <option value="0424">0424</option>
                                <option value="0426">0426</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Cédula de Identidad:</label>
                            <div class="flex gap-2">
                                <div id="ci-type-display" class="custom-select-display w-1/4" required>
                                    Tipo <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </div>
                                <input type="text" id="ci-number" placeholder="Ej: 12345678" class="w-3/4 rounded-lg p-3 focus:outline-none focus:ring-2 animated-input" pattern="[0-9]{6,9}" title="6 a 9 dígitos numéricos" required>
                            </div>
                            <select id="ci-type-select" class="hidden"> <!-- SELECT OCULTO -->
                                <option value="V">V</option>
                                <option value="E">E</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label for="address" class="form-label">Dirección (Solo Caracas):</label>
                        <input type="text" id="address" placeholder="Ej: Av. Principal, Edif. Central, Apt 101, Caracas" class="w-full rounded-lg p-3 focus:outline-none focus:ring-2 animated-input" required>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="dob" class="form-label">Fecha de Nacimiento:</label>
                            <input type="date" id="dob" class="w-full rounded-lg p-3 focus:outline-none focus:ring-2 animated-input" required>
                        </div>
                        <div>
                            <label class="form-label">Edad:</label>
                            <p id="age-display" class="display-field"></p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Curso a Postularse:</label>
                            <div id="course-to-apply-display" class="custom-select-display w-full" required>
                                Selecciona un curso <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                            <select id="course-to-apply-select" class="hidden"> <!-- SELECT OCULTO -->
                                <option value="Asistente Administrativo">Asistente Administrativo</option>
                                <option value="Tecnico en refrigeracion y aires acondicionados">Técnico en refrigeración y aires acondicionados</option>
                                <option value="Chef">Chef</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Género:</label>
                            <div id="gender-display" class="custom-select-display w-full" required>
                                Selecciona tu género <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                            <select id="gender-select" class="hidden"> <!-- SELECT OCULTO -->
                                <option value="">Selecciona tu género</option>
                                <option value="Hombre">Hombre</option>
                                <option value="Mujer">Mujer</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fase 2: Datos Educativos -->
            <div id="phase-2" class="phase-content space-y-4 hidden">
                <div class="border border-gray-700 rounded-lg p-4 bg-[#1c1c24]">
                    <h2 class="section-title mb-4">Datos Educativos</h2>
                    <div>
                        <label class="form-label">Estado educativo actual:</label>
                        <div id="education-status-display" class="custom-select-display w-full" required>
                            Selecciona tu estado <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <select id="education-status-select" class="hidden"> <!-- SELECT OCULTO -->
                            <option value="">Selecciona tu estado</option>
                            <option value="Estudiando Liceo">Estudiando Liceo</option>
                            <option value="Graduado Liceo">Graduado Liceo</option>
                            <option value="Estudiando Universidad">Estudiando Universidad</option>
                            <option value="No estudiando">No estudiando</option>
                        </select>
                    </div>
                    <div id="study-shift-container" class="mt-4 hidden">
                        <label class="form-label">Turno de estudio:</label>
                        <div id="study-shift-display" class="custom-select-display w-full">
                            Selecciona el turno <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <select id="study-shift-select" class="hidden"> <!-- SELECT OCULTO -->
                            <option value="">Selecciona el turno</option>
                            <option value="Tarde">Tarde</option>
                            <option value="Manana">Mañana</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">Nivel de Estudio cursado:</label>
                        <div id="current-study-level-display" class="custom-select-display w-full" required>
                            Selecciona el nivel <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <select id="current-study-level-select" class="hidden"> <!-- SELECT OCULTO -->
                            <option value="">Selecciona el nivel</option>
                            <option value="3er año">3er año</option>
                            <option value="4to año">4to año</option>
                            <option value="5to año">5to año</option>
                            <option value="Bachiller">Bachiller</option>
                        </select>
                    </div>
                    <div>
                        <label for="institution" class="form-label">Institución Educativa (Última o Actual):</label>
                        <input type="text" id="institution" placeholder="Ej: U.E.N. Simón Bolívar / U.C.V." class="w-full rounded-lg p-3 focus:outline-none focus:ring-2 animated-input" required>
                    </div>
                    <div>
                        <label for="degree" class="form-label">Grado/Título Obtenido (si aplica):</label>
                        <input type="text" id="degree" placeholder="Ej: Bachiller en Ciencias / Licenciado" class="w-full rounded-lg p-3 focus:outline-none focus:ring-2 animated-input">
                    </div>
                    <div>
                        <label for="graduation-year" class="form-label">Año de Graduación (o Esperado):</label>
                        <input type="number" id="graduation-year" min="2023" max="2025" step="1" value="" placeholder="Ej: 2025" class="w-full rounded-lg p-3 focus:outline-none focus:ring-2 animated-input" required>
                        <p class="text-gray-500 text-xs mt-1">Ingresa el año en que obtuviste o esperas obtener tu título.</p>
                    </div>
                </div>
            </div>

            <!-- Fase 3: Subir Documentos -->
            <div id="phase-3" class="phase-content space-y-4 hidden">
                <div class="border border-gray-700 rounded-lg p-4 bg-[#1c1c24]">
                    <h2 class="section-title mb-4">Subir Documentos</h2>
                    <p class="text-gray-500 mb-4 text-sm">Por favor, sube los documentos solicitados. (La funcionalidad de subida real a Firebase Storage se implementará más adelante).</p>
                    <div>
                        <label for="ci-upload" class="form-label">Cédula de Identidad (PDF o JPG):</label>
                        <input type="file" id="ci-upload" accept=".pdf,.jpg,.jpeg,.png" class="w-full rounded-lg p-3 focus:outline-none focus:ring-2 animated-input file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    </div>
                    <div class="mt-4">
                        <label for="degree-upload" class="form-label">Título / Certificado más alto (PDF o JPG):</label>
                        <input type="file" id="degree-upload" accept=".pdf,.jpg,.jpeg,.png" class="w-full rounded-lg p-3 focus:outline-none focus:ring-2 animated-input file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    </div>
                    <div class="mt-4">
                        <label for="other-docs-upload" class="form-label">Otros documentos relevantes (Opcional - PDF o JPG):</label>
                        <input type="file" id="other-docs-upload" accept=".pdf,.jpg,.jpeg,.png" multiple class="w-full rounded-lg p-3 focus:outline-none focus:ring-2 animated-input file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    </div>
                    <div class="mt-6 flex items-center">
                        <input type="checkbox" id="agree-terms" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="agree-terms" class="ml-2 block text-sm text-gray-300">
                            Acepto los <a href="#" class="text-blue-400 hover:underline">términos y condiciones</a> del Instituto Gerencial de Talentos 2025.
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Botones de Navegación -->
            <div class="flex justify-between mt-8 pt-4 border-t border-gray-700">
                <button type="button" id="prev-phase-btn" class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors animated-btn hidden">
                    Anterior
                </button>
                <button type="button" id="next-phase-btn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors animated-btn">
                    Siguiente
                </button>
                <button type="submit" id="finish-registration-btn" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors animated-btn hidden">
                    Finalizar Registro
                </button>
            </div>
        </form>

        <div class="mt-8 text-center">
            <button onclick="handleLogout()" class="text-gray-400 hover:text-blue-400 hover:underline">
                Cerrar Sesión
            </button>
        </div>
    </div>

    <!-- Modal para Selectores Personalizados -->
    <div id="custom-select-modal" class="custom-select-modal-overlay hidden opacity-0">
        <div class="custom-select-modal-content">
            <h3 id="modal-title" class="text-xl font-semibold mb-4 text-white"></h3>
            <div id="modal-options-container" class="space-y-2">
                <!-- Las opciones se cargarán aquí dinámicamente -->
            </div>
        </div>
    </div>
    <!-- Fin Modal -->
</body>
</html>
